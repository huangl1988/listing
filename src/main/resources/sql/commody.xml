<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pfq.deal.trans_listing.dao.ICommodyDao">
	
	<sql id="commodity_details">
			id,
			commodity_code AS commodyCode,
			commoditiy_name AS commodyName,
			shop_id AS shopId,
			inserttime AS inserttime
	</sql>
	
	<insert id="insert" keyProperty="id" parameterType="com.pfq.deal.trans_listing.dto.CommodyDTO">
		INSERT INTO tb_commodity(
		commodity_code,
		<if test="shopId!=null">
			shop_id,
		</if>
		commoditiy_name

		)
		VALUES(
		#{commodyCode},
		<if test="shopId!=null">
			#{shopId},
		</if>
		#{commodyName}
		) 
	</insert>
	
	<update id="update" parameterType="com.pfq.deal.trans_listing.dto.CommodyDTO">
		UPDATE tb_commodity
		SET
		<if test="commodyCode!=null">
			commodity_code=#{commodyCode},
		</if>
		<if test="commoditiyName!=null">
			commoditiy_name=#{commodyName},
		</if>
		 updatetime=now()
		 WHERE 
		 	id=#{id}
	</update>
	
	<delete id="delete">
		DELETE FROM tb_commodity WHERE id=#{id} AND NOT EXISTS (
	SELECT
		1
	FROM
		tb_commody_shop WHERE tb_commody_shop.commody_id = tb_commodity.id
	)
	</delete>
	
	<select id="select" resultType="com.pfq.deal.trans_listing.dto.CommodyDTO">
		SELECT	
			<include refid="commodity_details"/>
		 FROM  tb_commodity
		 WHERE
		 	id=#{id}
	</select>
	
	<select id="selectList" resultType="com.pfq.deal.trans_listing.dto.CommodyDTO">
		SELECT	
			<include refid="commodity_details"/>
		 FROM  tb_commodity
		 WHERE
			1=1
		<if test="shopId!=null">
			AND shop_id=#{shopId}
		</if>
	</select>
</mapper>